<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
	<title>Resize Test</title>
</head>
<style type="text/css">
	.container {
		overflow: hidden;
	}
	.left-side {
		float: left;
		height: 500px;
		width: 250px;
		background-color: #aaa;
		transition: width .5s;
	}
	.left-side.shrink {
		width: 30px;
	}
	#main {
		height: 500px;
		background-color: #bbe;
		overflow: hidden;
	}
</style>
<body>
<h1>Resize Test</h1>
<div class="container">
	<div>
		<label>Strategy</label>
		<select id="strategySelect">
			<option value="none">none</option>
			<option value="hiddenObject">hidden object</option>
			<option value="mutationObserver">mutation observer</option>
			<option value="scroll">scroll</option>
			<option value="resizeObserver">resize observer</option>
		</select>
	</div>
	<div>
		<label>display: none</label>
		<input type="checkbox" id="displayNoneCheckbox">
	</div>
	<aside class="left-side" id="side"></aside>
	<main id="main"></main>
</div>
<script type="text/javascript" src="../src/EventEmitter.js"></script>
<script type="text/javascript" src="../src/HiddenObject.js"></script>
<script type="text/javascript" src="../src/NativeResizeObserver.js"></script>
<script type="text/javascript" src="../src/Scroll.js"></script>
<script type="text/javascript">
	const strategies = {
		'none': null,
		'hiddenObject': HiddenObjectResizeObserver,
		'mutationObserver': null,
		'scroll': ScrollResizeObserver,
		'resizeObserver': NativeResizeObserver
	}
	const strategySelect = document.getElementById('strategySelect');
	const displayNoneCheckbox = document.getElementById('displayNoneCheckbox');
	const side = document.getElementById('side');
	const main = document.getElementById('main');

	side.addEventListener('click', () => {
		side.classList.toggle('shrink');
	});

	displayNoneCheckbox.addEventListener('change', (e) => {
		if(e.target.checked) {
			main.style.display = 'none';
		} else {
			main.style.display = '';
		}
	});

	let observer = null;
	strategySelect.addEventListener('change', (e) => {
		const strategy = strategies[e.target.value];
		observer && observer.destroy();
		observer = strategy && new strategy(main);
		observer && observer.on('resize', () => {
			console.log('resize');
		});
	});
</script>
</body>
</html>